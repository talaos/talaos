<ion-header *ngIf="interfacetype=='central'">

  <ion-navbar>
    <ion-title *ngIf="selectedItem.id>0">Ticket #{{selectedItem.id}} - {{selectedItem.name}}</ion-title>
    <ion-title *ngIf="selectedItem.id==0">{{ "New ticket" | translate }}</ion-title>
    <ion-buttons end *ngIf="changed">
      <button ion-button icon-end solid color="danger" (click)="updateItem()">
        <ion-icon name="md-send"></ion-icon>
        {{ "Save modifications" | translate }}
      </button>
    </ion-buttons>
  </ion-navbar>

  <ion-toolbar no-border-top>
    <ion-segment [(ngModel)]="ticketzone">
      <ion-segment-button value="summary">
        <ion-icon name="md-information-circle"></ion-icon>
      </ion-segment-button>
      <ion-segment-button value="details">
        <ion-icon name="md-filing"></ion-icon>
      </ion-segment-button>
      <ion-segment-button value="actors">
        <ion-icon name="md-contacts"></ion-icon>
      </ion-segment-button>
      <ion-segment-button value="dates">
        <ion-icon name="md-time"></ion-icon>
      </ion-segment-button>
      <ion-segment-button value="traitement">
        <ion-icon name="md-chatbubbles"></ion-icon>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>


<ion-content *ngIf="interfacetype=='central'">
  <ion-grid>
    <ion-row>
      <ion-col col-12 col-lg-4>
        <ion-item>
          <ion-label>{{ "Type" | translate }}</ion-label>
          <ion-select [(ngModel)]="selectedItem.type" interface="popover" (ionChange)="changeField('type')">
            <ion-option *ngFor="let type of types" [value]="type.value">
              {{type.viewValue}}
            </ion-option>
          </ion-select>
        </ion-item>
      </ion-col>
      <ion-col col-12 col-lg-4>
        <ion-item>
          <ion-label>{{ "Category" | translate }}</ion-label>
          <input type="hidden" [(ngModel)]="selectedItem.itilcategories_id" value="0" (input)="changeField('itilcategories_id')"/>
          <ion-input type="text" [(ngModel)]="selectedItem.itilcategories_name" (click)="openDropdownSelect('ITILCategory', true, 'ticketcategory')" [readonly]="true"></ion-input>
        </ion-item>
      </ion-col>
      <ion-col col-12 col-lg-4>
        <ion-item *ngIf="!hiddenItem.id12">
          <ion-label>{{ "Status" | translate }}</ion-label>
          <ion-select [(ngModel)]="selectedItem.status" interface="popover" (ionChange)="changeField('status')">
            <ion-option *ngFor="let st of status" [value]="st.value">
              {{st.viewValue}}
            </ion-option>
          </ion-select>
        </ion-item>
      </ion-col>
    </ion-row>
  </ion-grid>
  <br>

  <div [ngSwitch]="ticketzone">
    <ion-list *ngSwitchCase="'summary'">
      <ion-item *ngIf="!hiddenItem.id1">
        <ion-label floating>{{ "Title" | translate }}</ion-label>
        <ion-input type="text" [(ngModel)]="selectedItem.name" value="{{selectedItem.name}}" (input)="changeField('name')"></ion-input>
      </ion-item>

      <ion-item *ngIf="!hiddenItem.id21">
        <ion-label floating>{{ "Description" | translate }}</ion-label>
        <ion-textarea type="text" [(ngModel)]="selectedItem.content" value="{{selectedItem.content}}" [attr.rows]="25" (input)="changeField('content')"></ion-textarea>
      </ion-item>
    </ion-list>


    <ion-list *ngSwitchCase="'actors'">
      <ion-grid>
        <ion-row>
          <ion-col col-12 col-lg-4>
            <ion-item-group *ngIf="!hiddenItem.id4 || !hiddenItem.id71">
              <ion-item-divider color="light">{{ "Requesters" | translate }}
                <ion-fab right middle>
                  <button ion-fab mini><ion-icon name="add"></ion-icon></button>
                  <ion-fab-list side="left">
                    <button ion-fab (click)="addActors.showUser=true" *ngIf="!hiddenItem.id4"><ion-icon name="person"></ion-icon></button>
                    <button ion-fab (click)="addActors.showGroup=true" *ngIf="!hiddenItem.id71"><ion-icon name="md-people"></ion-icon></button>
                  </ion-fab-list>
                </ion-fab>
              </ion-item-divider>

              <ion-item *ngIf="addActors.showUser">
                <ion-label floating>{{ "User" | translate }}</ion-label>
                <input type="hidden" [(ngModel)]="addActors.users_id" value="0"/>
                <ion-input type="text" [(ngModel)]="addActors.users_name" (click)="openDropdownSelect('User', true)" [readonly]="true"></ion-input>
              </ion-item>

              <ion-item *ngIf="addActors.showGroup">
                <ion-label floating>{{ "Group" | translate }}</ion-label>
                <input type="hidden" [(ngModel)]="addActors.groups_id" value="0"/>
                <ion-input type="text" [(ngModel)]="addActors.groups_name" (click)="openDropdownSelect('Group', true)" [readonly]="true"></ion-input>
              </ion-item>

              <ion-item *ngFor="let item of actors.demandeurs">
                <ion-icon name="person" item-start></ion-icon>
                {{item.users_id}}
              </ion-item>
              <ion-item *ngFor="let item of groups.demandeurs">
                <ion-icon name="md-people" item-start></ion-icon>
                {{item.groups_id}}
              </ion-item>
            </ion-item-group>
          </ion-col>

          <ion-col col-12 col-lg-4>
            <ion-item-group *ngIf="!hiddenItem.id65 || !hiddenItem.id66">
              <ion-item-divider color="light">{{ "Observers" | translate }}
                <ion-fab right middle>
                  <button ion-fab mini (click)="addObserver()"><ion-icon name="add"></ion-icon></button>
                </ion-fab>
              </ion-item-divider>
              <ion-item *ngFor="let item of actors.observateurs">
                <ion-icon name="person" item-start></ion-icon>
                {{item.users_id}}
              </ion-item>
              <ion-item *ngFor="let item of groups.observateurs">
                <ion-icon name="md-people" item-start></ion-icon>
                {{item.groups_id}}
              </ion-item>
            </ion-item-group>
          </ion-col>

          <ion-col col-12 col-lg-4>
            <ion-item-group *ngIf="!hiddenItem.id5 || !hiddenItem.id6 || !hiddenItem.id8">
              <ion-item-divider color="light">{{ "Assigned" | translate }}
                <ion-fab right middle>
                  <button ion-fab mini (click)="addAssigned()"><ion-icon name="add"></ion-icon></button>
                </ion-fab>
              </ion-item-divider>

              <ion-item *ngIf="addActors.showUserAssigned">
                <ion-label floating>{{ "User" | translate }}</ion-label>
                <input type="hidden" [(ngModel)]="addActors.users_id" value="0"/>
                <ion-input type="text" [(ngModel)]="addActors.users_name" (click)="openDropdownSelect('User', true)" [readonly]="true"></ion-input>
              </ion-item>

              <ion-item *ngIf="addActors.showGroupAssigned">
                <ion-label floating>{{ "Group" | translate }}</ion-label>
                <input type="hidden" [(ngModel)]="addActors.groups_id" value="0"/>
                <ion-input type="text" [(ngModel)]="addActors.groups_name" (click)="openDropdownSelect('Group', true)" [readonly]="true"></ion-input>
              </ion-item>

              <ion-item *ngFor="let item of actors.assignes">
                <ion-icon name="person" item-start></ion-icon>
                {{item.users_id}}
              </ion-item>
              <ion-item *ngFor="let item of groups.assignes">
                <ion-icon name="md-people" item-start></ion-icon>
                {{item.groups_id}}
              </ion-item>
            </ion-item-group>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-list>

    <ion-list *ngSwitchCase="'dates'">
      <ion-grid>
        <ion-row>
          <ion-col col-sm-12 col-md-3>
            <ion-item *ngIf="!hiddenItem.id15">
              <ion-label floating>{{ "Opening date" | translate }}</ion-label>
              <ion-datetime displayFormat="YYYY-MM-DD HH:mm:ss" [(ngModel)]="selectedItem.date"></ion-datetime>
            </ion-item>
          </ion-col>
          <ion-col col-sm-12 col-md-3>
            <ion-item *ngIf="!hiddenItem.id19">
              <ion-label floating>{{ "Last modification" | translate }}</ion-label>
              <ion-datetime displayFormat="YYYY-MM-DD HH:mm:ss" [(ngModel)]="selectedItem.date_mod"></ion-datetime>
            </ion-item>
          </ion-col>
          <ion-col col-sm-12 col-md-3>
            <ion-item *ngIf="!hiddenItem.id17">
              <ion-label floating>{{ "solve date" | translate }}</ion-label>
              <ion-datetime displayFormat="YYYY-MM-DD HH:mm:ss" [(ngModel)]="selectedItem.solvedate"></ion-datetime>
            </ion-item>
          </ion-col>
          <ion-col col-sm-12 col-md-3>
            <ion-item *ngIf="!hiddenItem.id16">
              <ion-label floating>{{ "Close date" | translate }}</ion-label>
              <ion-datetime displayFormat="YYYY-MM-DD HH:mm:ss" [(ngModel)]="selectedItem.closedate"></ion-datetime>
            </ion-item>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-list>

    <ion-list *ngSwitchCase="'details'">
      <ion-item *ngIf="!hiddenItem.id22">
        <ion-label floating>{{ "Created by" | translate }}</ion-label>
        <ion-input type="text" value="{{selectedItem.users_id_recipient}}" [readonly]="true"></ion-input>
      </ion-item>
      <ion-item *ngIf="!hiddenItem.id29">
        <ion-label floating>{{ "Request type" | translate }}</ion-label>
        <input type="hidden" [(ngModel)]="selectedItem.requesttypes_id" value="0"/>
        <ion-input type="text" [(ngModel)]="selectedItem.requesttypes_name" (click)="openDropdownSelect('RequestType', true, 'ticketrequesttype')" [readonly]="true"></ion-input>
      </ion-item>
      <ion-item *ngIf="!hiddenItem.id10">
        <ion-label floating>{{ "Urgency" | translate }}</ion-label>
        <ion-select [(ngModel)]="selectedItem.urgency" interface="popover" (ionChange)="changeField('urgency')">
          <ion-option *ngFor="let val of urgencyImpact" [value]="val.value">
            {{val.viewValue}}
          </ion-option>
        </ion-select>
      </ion-item>
      <ion-item *ngIf="!hiddenItem.id11">
        <ion-label floating>{{ "Impact" | translate }}</ion-label>
        <ion-select [(ngModel)]="selectedItem.impact" interface="popover" (ionChange)="changeField('impact')">
          <ion-option *ngFor="let val of urgencyImpact" [value]="val.value">
            {{val.viewValue}}
          </ion-option>
        </ion-select>
      </ion-item>
      <ion-item *ngIf="!hiddenItem.id3">
        <ion-label floating>{{ "Priority" | translate }}</ion-label>
        <ion-select [(ngModel)]="selectedItem.priority" interface="popover" (ionChange)="changeField('priority')">
          <ion-option *ngFor="let val of priorities" [value]="val.value">
            {{val.viewValue}}
          </ion-option>
        </ion-select>
      </ion-item>
      <ion-item *ngIf="!hiddenItem.id83">
        <ion-label floating>{{ "Location" | translate }}</ion-label>
        <input type="hidden" [(ngModel)]="selectedItem.locations_id" value="0" (input)="changeField('locations_id')"/>
        <ion-input type="text" [(ngModel)]="selectedItem.locations_name" (click)="openDropdownSelect('Location', true, 'ticketlocation')" [readonly]="true"></ion-input>
      </ion-item>
      <!--
      <ion-item>
        <ion-label floating>Validation</ion-label>
        //
      </ion-item>
      <ion-item>
        <ion-label floating>Éléments associés</ion-label>
        //
      </ion-item>
      <ion-item>
        <ion-label floating>Tickets liés</ion-label>
        //
      </ion-item>
      -->
    </ion-list>

    <ion-list *ngSwitchCase="'traitement'">
      <ion-fab right top #fabtraitement>
        <button ion-fab><ion-icon name="add"></ion-icon></button>
        <ion-fab-list side="bottom">
          <button ion-fab color="ticketfollowup" (click)="displayForm('followup', fabtraitement)"><ion-icon name="md-chatboxes"></ion-icon></button>
          <button ion-fab color="tickettask" (click)="displayForm('task', fabtraitement)"><ion-icon name="md-checkbox-outline"></ion-icon></button>
          <button ion-fab color="ticketdocument"><ion-icon name="md-document"></ion-icon></button>
          <button ion-fab color="ticketsolution"><ion-icon name="md-checkmark"></ion-icon></button>
        </ion-fab-list>
      </ion-fab>

      <!-- New followup form -->
      <ion-card *ngIf="newfollowup.content != null" color="ticketfollowup">
        <ion-card-header>
          {{ "New followup" | translate }}
        </ion-card-header>
        <ion-list>
          <ion-item>
            <ion-label floating>{{ "Description" | translate }}</ion-label>
            <ion-textarea type="text" [(ngModel)]="newfollowup.content" value="{{newfollowup.content}}" [attr.rows]="25"></ion-textarea>
          </ion-item>
          <ion-item>
            <ion-label floating>{{ "Followup type" | translate }}</ion-label>
            <input type="hidden" [(ngModel)]="newfollowup.requesttypes_id" value="0"/>
            <ion-input type="text" [(ngModel)]="newfollowup.requesttypes_name" (click)="openDropdownSelect('RequestType', false)" [readonly]="true"></ion-input>
          </ion-item>
          <ion-item>
            <ion-label>{{ "Private" | translate }}</ion-label>
            <ion-toggle [(ngModel)]="newfollowup.is_private" color="danger"></ion-toggle>
          </ion-item>
        </ion-list>
        <button ion-button full (click)="addFollowup()">{{ "Create the followup" | translate }}</button>
      </ion-card>

      <!-- New task form -->
      <ion-card *ngIf="newtask.content != null" color="tickettask">
        <ion-card-header>
          {{ "New task" | translate }}
        </ion-card-header>
        <ion-list>
          <ion-item>
            <ion-label floating>{{ "Description" | translate }}</ion-label>
            <ion-textarea type="text" [(ngModel)]="newtask.content" value="{{newtask.content}}" [attr.rows]="25"></ion-textarea>
          </ion-item>
          <ion-item>
            <ion-label floating>{{ "User"| translate }}</ion-label>
            <input type="hidden" [(ngModel)]="newtask.users_id_tech" value="0"/>
            <ion-input type="text" [(ngModel)]="newtask.users_tech_name" (click)="openDropdownSelect('User', false, 'taskusertech')" [readonly]="true"></ion-input>
          </ion-item>
          <ion-item>
            <ion-label floating>{{ "Group" | translate }}</ion-label>
            <input type="hidden" [(ngModel)]="newtask.groups_id_tech" value="0"/>
            <ion-input type="text" [(ngModel)]="newtask.groups_tech_name" (click)="openDropdownSelect('Group', false, 'taskgrouptech')" [readonly]="true"></ion-input>
          </ion-item>
        </ion-list>
        <button ion-button full (click)="addTask()">{{ "Create the task" | translate }}</button>
      </ion-card>

      <ion-card *ngFor="let item of timeline" color="{{item._color}}">
        <ion-item color="{{item._color}}">
          <ion-icon name="{{item._type}}" item-start large></ion-icon>
          <h2>{{item.users_id}}</h2>
        </ion-item>

        <ion-card-content>
          <p>{{item.content}}</p>
        </ion-card-content>

        <ion-row>
          <ion-col *ngIf="item.is_private">
            <button ion-button icon-left clear small>
              <ion-icon name="md-lock" color="danger"> {{ "Private" | translate }}</ion-icon>
            </button>
          </ion-col>
          <ion-col center text-center>
            {{item.requesttypes_id}}
          </ion-col>
          <ion-col center text-center>
            {{item.date}}
          </ion-col>
        </ion-row>
      </ion-card>

    </ion-list>

  </div>
</ion-content>


<ion-header *ngIf="interfacetype=='helpdesk'">

  <ion-navbar>
    <ion-title *ngIf="selectedItem.id>0">Ticket #{{selectedItem.id}} - {{selectedItem.name}}</ion-title>
    <ion-title *ngIf="selectedItem.id==0">{{ "New ticket" | translate }}</ion-title>
    <ion-buttons end *ngIf="changed">
      <button ion-button icon-end solid color="danger" (click)="updateItem()">
        <ion-icon name="md-send"></ion-icon>
        {{ "Save modifications" | translate }}
      </button>
    </ion-buttons>
  </ion-navbar>
</ion-header>

<ion-content padding *ngIf="interfacetype=='helpdesk'">
  <ion-grid class="ticket-form-{{selectedItem.headerClass}}">
    <ion-row>
      <ion-col col-sm-12 col-md-4>
        <ion-card class="card-ticket" >
          <ion-card-header>
            General
          </ion-card-header>
          <ion-card-content>
            <ion-list>
              <ion-item no-lines>
                <ion-range min="0" max="1" step="1">
                  <ion-label range-left style="text-align: center;padding-left: 20%;">
                    <i style="font-size: 36px;" class="fas fa-ambulance"></i>
                    <br>incident
                  </ion-label>
                  <ion-label range-right style="text-align: center;padding-right: 20%;">
                    <i style="font-size: 36px;" class="fas fa-paper-plane"></i>
                    <br>demande
                  </ion-label>
                </ion-range>
              </ion-item>
              <ion-item no-lines>
                <ion-label>{{ "Category" | translate }}</ion-label>
                <input type="hidden" [(ngModel)]="selectedItem.itilcategories_id" value="0" (input)="changeField('itilcategories_id')"/>
                <ion-input type="text" [(ngModel)]="selectedItem.itilcategories_name" (click)="openDropdownSelect('ITILCategory', true, 'ticketcategory')" [readonly]="true"></ion-input>
              </ion-item>
              <ion-item no-lines *ngIf="selectedItem.id > 0">
                <ion-label>{{ "Status" | translate }}</ion-label>
                <ion-select [(ngModel)]="selectedItem.status" interface="popover" (ionChange)="changeField('status')" disabled>
                  <ion-option *ngFor="let st of status" [value]="st.value">
                    {{st.viewValue}}
                  </ion-option>
                </ion-select>
              </ion-item>
              <ion-item no-lines *ngIf="!hiddenItem.id1">
                <ion-label floating>{{ "Title" | translate }}</ion-label>
                <ion-input type="text" [(ngModel)]="selectedItem.name" value="{{selectedItem.name}}" (input)="changeField('name')"></ion-input>
              </ion-item>
              <ion-item no-lines *ngIf="!hiddenItem.id21">
                <ion-label floating>{{ "Description" | translate }}</ion-label>
                <ion-textarea type="text" [(ngModel)]="selectedItem.content" value="{{selectedItem.content}}" [attr.rows]="10" (input)="changeField('content')"></ion-textarea>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>
      </ion-col>

      <ion-col col-sm-12 col-md-4>
        <ion-card class="card-ticket">
          <ion-card-header>
            Details
          </ion-card-header>
            <ion-list>
              <ion-item *ngIf="!hiddenItem.id15">
                <ion-label>{{ "Opening date" | translate }}</ion-label>
                <ion-datetime displayFormat="YYYY-MM-DD HH:mm:ss" [(ngModel)]="selectedItem.date"></ion-datetime>
              </ion-item>
              <ion-item *ngIf="!hiddenItem.id19">
                <ion-label>{{ "Last modification" | translate }}</ion-label>
                <ion-datetime displayFormat="YYYY-MM-DD HH:mm:ss" [(ngModel)]="selectedItem.date_mod"></ion-datetime>
              </ion-item>
              <ion-item *ngIf="!hiddenItem.id17 * selectedItem.status >= 4">
                <ion-label>{{ "solve date" | translate }}</ion-label>
                <ion-datetime displayFormat="YYYY-MM-DD HH:mm:ss" [(ngModel)]="selectedItem.solvedate"></ion-datetime>
              </ion-item>
              <ion-item *ngIf="!hiddenItem.id16 * selectedItem.status >= 5">
                <ion-label>{{ "Close date" | translate }}</ion-label>
                <ion-datetime displayFormat="YYYY-MM-DD HH:mm:ss" [(ngModel)]="selectedItem.closedate"></ion-datetime>
              </ion-item>
              <ion-item *ngIf="!hiddenItem.id22">
                <ion-label>{{ "Created by" | translate }}</ion-label>
                <ion-input item-end type="text" value="{{selectedItem.users_id_recipient}}" [readonly]="true"></ion-input>
              </ion-item>
              <ion-item *ngIf="!hiddenItem.id29">
                <ion-label>{{ "Request type" | translate }}</ion-label>
                <input type="hidden" [(ngModel)]="selectedItem.requesttypes_id" value="0"/>
                <ion-input item-end type="text" [(ngModel)]="selectedItem.requesttypes_name" (click)="openDropdownSelect('RequestType', true, 'ticketrequesttype')" [readonly]="true"></ion-input>
              </ion-item>
              <ion-item *ngIf="!hiddenItem.id10">
                <p style="color: #999;">{{ "Urgency" | translate }}</p>
                <i item-end style="font-size: 18px;" class="fas fa-seedling urgency{{rateClass.urgency[1]}}" (click)="setRate('urgency', 1)"></i>
                <i item-end style="font-size: 18px;" class="fas fa-seedling urgency{{rateClass.urgency[2]}}" (click)="setRate('urgency', 2)"></i>
                <i item-end style="font-size: 18px;" class="fas fa-seedling urgency{{rateClass.urgency[3]}}" (click)="setRate('urgency', 3)"></i>
                <i item-end style="font-size: 18px;" class="fas fa-seedling urgency{{rateClass.urgency[4]}}" (click)="setRate('urgency', 4)"></i>
                <i item-end style="font-size: 18px;" class="fas fa-seedling urgency{{rateClass.urgency[5]}}" (click)="setRate('urgency', 5)"></i>
              </ion-item>
              <ion-item *ngIf="!hiddenItem.id11">
                <p style="color: #999;">{{ "Impact" | translate }}</p>
                <i item-end style="font-size: 18px;" class="fas fa-seedling impact{{rateClass.impact[1]}}" (click)="setRate('impact', 1)"></i>
                <i item-end style="font-size: 18px;" class="fas fa-seedling impact{{rateClass.impact[2]}}" (click)="setRate('impact', 2)"></i>
                <i item-end style="font-size: 18px;" class="fas fa-seedling impact{{rateClass.impact[3]}}" (click)="setRate('impact', 3)"></i>
                <i item-end style="font-size: 18px;" class="fas fa-seedling impact{{rateClass.impact[4]}}" (click)="setRate('impact', 4)"></i>
                <i item-end style="font-size: 18px;" class="fas fa-seedling impact{{rateClass.impact[5]}}" (click)="setRate('impact', 5)"></i>
              </ion-item>
              <ion-item *ngIf="!hiddenItem.id3">
                <p style="color: #999;">{{ "Priority" | translate }}</p>
                <i item-end style="font-size: 18px;" class="fas fa-seedling priority{{rateClass.priority[1]}}" (click)="setRate('priority', 1)"></i>
                <i item-end style="font-size: 18px;" class="fas fa-seedling priority{{rateClass.priority[2]}}" (click)="setRate('priority', 2)"></i>
                <i item-end style="font-size: 18px;" class="fas fa-seedling priority{{rateClass.priority[3]}}" (click)="setRate('priority', 3)"></i>
                <i item-end style="font-size: 18px;" class="fas fa-seedling priority{{rateClass.priority[4]}}" (click)="setRate('priority', 4)"></i>
                <i item-end style="font-size: 18px;" class="fas fa-seedling priority{{rateClass.priority[5]}}" (click)="setRate('priority', 5)"></i>
              </ion-item>
              <ion-item *ngIf="!hiddenItem.id83">
                <ion-label floating>{{ "Location" | translate }}</ion-label>
                <input type="hidden" [(ngModel)]="selectedItem.locations_id" value="0" (input)="changeField('locations_id')"/>
                <ion-input type="text" [(ngModel)]="selectedItem.locations_name" (click)="openDropdownSelect('Location', true, 'ticketlocation')" [readonly]="true"></ion-input>
              </ion-item>
            </ion-list>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>
  <span class="fa-stack fa-2x">
  <i class="far fa-calendar fa-stack-2x"></i>
  <i class="fas fa-play fa-stack-1x"></i>
</span>

</ion-content>
